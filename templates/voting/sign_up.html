{#templates/voting/sign_up.html#}
{% extends 'voting/secondary_base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <div class="signup-page">
        <h2>Create an Account</h2>
        <form method="POST" id="signup-form">
            {% csrf_token %}

            <!-- Username Field -->
            <div class="form-group">
                <label for="id_username">Username:</label>
                {{ form.username }}
                {% if form.username.errors %}
                    <div class="error">
                        {% for error in form.username.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- First Name Field -->
            <div class="form-group">
                <label for="id_first_name">First Name:</label>
                {{ form.first_name }}
                {% if form.first_name.errors %}
                    <div class="error">
                        {% for error in form.first_name.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Last Name Field -->
            <div class="form-group">
                <label for="id_last_name">Last Name:</label>
                {{ form.last_name }}
                {% if form.last_name.errors %}
                    <div class="error">
                        {% for error in form.last_name.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Email Field -->
            <div class="form-group">
                <label for="id_email">Email:</label>
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="error">
                        {% for error in form.email.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Password Fields -->
            <div class="form-group">
                <label for="id_password1">Password:</label>
                {{ form.password1 }}
                {% if form.password1.errors %}
                    <div class="error">
                        {% for error in form.password1.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_password2">Confirm Password:</label>
                {{ form.password2 }}
                {% if form.password2.errors %}
                    <div class="error">
                        {% for error in form.password2.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Role Field -->
            <div class="form-group">
                <label for="id_role">Role:</label>
                {{ form.role }}
                {% if form.role.errors %}
                    <div class="error">
                        {% for error in form.role.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Gender Field -->
            <div class="form-group">
                <label for="id_gender">Gender:</label>
                {{ form.gender }}
                {% if form.gender.errors %}
                    <div class="error">
                        {% for error in form.gender.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Age Group Field -->
            <div class="form-group">
                <label for="id_age_group">Age Group:</label>
                {{ form.age_group }}
                {% if form.age_group.errors %}
                    <div class="error">
                        {% for error in form.age_group.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Country Dropdown -->
            <div class="form-group">
                <label for="id_country">Country:</label>
                <select id="id_country" name="country" class="form-control">
                    <option value="">Select Country</option>
                </select>
                {% if form.country.errors %}
                    <div class="error">
                        {% for error in form.country.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

{#            <!-- Region Dropdown -->#}
{#            <div class="form-group">#}
{#                <label for="id_region">Region:</label>#}
{#                <select id="id_region" name="region" class="form-control">#}
{#                    <option value="">Select Region</option>#}
{#                </select>#}
{#                {% if form.region.errors %}#}
{#                    <div class="error">#}
{#                        {% for error in form.region.errors %}#}
{#                            <p>{{ error }}</p>#}
{#                        {% endfor %}#}
{#                    </div>#}
{#                {% endif %}#}
{#            </div>#}

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary">Sign Up</button>
        </form>
    </div>
</div>

<!-- JavaScript for Country & Region Selection -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
    const countryDropdown = document.getElementById("id_country");
    const regionDropdown = document.getElementById("id_region");

    // Fetch and populate countries
    fetch("{% url 'get_countries' %}")
        .then(response => response.json())
        .then(data => {
            console.log(data);  // Log the entire response to inspect it

            if (data.countries) {
                data.countries.forEach(country => {
                    const option = new Option(country.name, country.name);
                    countryDropdown.appendChild(option);
                });
            } else {
                console.error("No 'countries' data found in the response.");
            }
        })
        .catch(error => console.error("Error fetching countries:", error));

    // Fetch regions for the selected country
    countryDropdown.addEventListener("change", function () {
        const countryName = this.value;
        loadRegions(countryName);
    });

    {#function loadRegions(countryName) {#}
    {#    regionDropdown.innerHTML = '<option value="">Select Region</option>'; // Reset regions#}
    {##}
    {#    if (countryName) {#}
    {#        fetch("{% url 'get_regions' %}?country_name=" + countryName)#}
    {#            .then(response => response.json())#}
    {#            .then(data => {#}
    {#                data.regions.forEach(region => {#}
    {#                    const option = new Option(region.name, region.name);#}
    {#                    regionDropdown.appendChild(option);#}
    {#                });#}
    {#            })#}
    {#            .catch(error => console.error("Error fetching regions:", error));#}
    {#    }#}
    
});

</script>

{% endblock %}
